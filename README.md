# WireGuard VPN Server

ะัะพะตะบั ะดะปั ัะฐะทะฒะตัััะฒะฐะฝะธั ัะพะฑััะฒะตะฝะฝะพะณะพ VPN-ัะตัะฒะตัะฐ ะฝะฐ ะฑะฐะทะต WireGuard ะฒ Docker-ะบะพะฝัะตะนะฝะตัะต ั ะฒะตะฑ-ะฟะฐะฝะตะปัั ัะฟัะฐะฒะปะตะฝะธั.

## ๐ ะะฟะธัะฐะฝะธะต

ะญัะพั ะฟัะพะตะบั ัะฐะทะฒะตัััะฒะฐะตั ะฟะพะปะฝะพััะฝะบัะธะพะฝะฐะปัะฝัะน VPN-ัะตัะฒะตั ะฝะฐ ะฒะฐัะตะผ VPS ั ะธัะฟะพะปัะทะพะฒะฐะฝะธะตะผ:
- **WireGuard** - ัะพะฒัะตะผะตะฝะฝัะน, ะฑัััััะน ะธ ะฑะตะทะพะฟะฐัะฝัะน VPN ะฟัะพัะพะบะพะป
- **wg-easy** - ัะดะพะฑะฝะฐั ะฒะตะฑ-ะฟะฐะฝะตะปั ะดะปั ัะฟัะฐะฒะปะตะฝะธั ะบะปะธะตะฝัะฐะผะธ
- **Docker** - ะบะพะฝัะตะนะฝะตัะธะทะฐัะธั ะดะปั ะธะทะพะปััะธะธ ะธ ัะดะพะฑััะฒะฐ ัะฟัะฐะฒะปะตะฝะธั
- **Apache2** - reverse proxy ั Basic Auth ะดะปั ะทะฐัะธัั ะฟะฐะฝะตะปะธ ะฐะดะผะธะฝะธัััะฐัะพัะฐ

## ๐ฅ๏ธ ะขัะตะฑะพะฒะฐะฝะธั ะบ ัะตัะฒะตัั

- **ะะก**: Ubuntu 22.04 x86_64 (ะธะปะธ ัะพะฒะผะตััะธะผะฐั)
- **CPU**: 2+ ัะดัะฐ
- **RAM**: 2 GB+
- **ะะธัะบ**: 20 GB+
- **ะัะฐะฒะฐ**: root ะธะปะธ sudo ะดะพัััะฟ

## ๐๏ธ ะััะธัะตะบัััะฐ

```
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ             VPS Server (31.28.27.96)        โ
โ                                             โ
โ  โโโโโโโโโโโโโโโโ    โโโโโโโโโโโโโโโโโโโโ  โ
โ  โ   Apache2    โโโโโโ  Docker Engine   โ  โ
โ  โ              โ    โ                  โ  โ
โ  โ :80/443      โ    โ  โโโโโโโโโโโโโโ  โ  โ
โ  โ /vpn-admin โโโโโโ โ  โ  wg-easy   โ  โ  โ
โ  โ              โ    โ  โ            โ  โ  โ
โ  โโโโโโโโโโโโโโโโ    โ  โ :51820/udp โโโโผโโโผโโโ VPN Clients
โ                      โ  โ :51821/tcp โ  โ  โ
โ                      โ  โโโโโโโโโโโโโโ  โ  โ
โ                      โโโโโโโโโโโโโโโโโโโโ  โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
```

## ๐ฆ ะกัััะบัััะฐ ะฟัะพะตะบัะฐ

```
wireguard-vpn/
โโโ .env                          # ะะพะฝัะธะณััะฐัะธั ะฟะตัะตะผะตะฝะฝัั ะพะบััะถะตะฝะธั
โโโ docker-compose.yml            # Docker Compose ะบะพะฝัะธะณััะฐัะธั
โโโ install.sh                    # ะะปะฐะฒะฝัะน ัะบัะธะฟั ัััะฐะฝะพะฒะบะธ
โโโ README.md                     # ะญัะพั ัะฐะนะป
โโโ apache-configs/
โ   โโโ vpn-admin.conf            # ะะพะฝัะธะณััะฐัะธั Apache ะฒะธัััะฐะปัะฝะพะณะพ ัะพััะฐ
โโโ scripts/
    โโโ install_docker.sh         # ะฃััะฐะฝะพะฒะบะฐ Docker
    โโโ setup_system.sh           # ะะฐัััะพะนะบะฐ ัะธััะตะผั (IP forwarding, firewall)
    โโโ deploy_vpn.sh             # ะะฐะทะฒะตัััะฒะฐะฝะธะต VPN ะบะพะฝัะตะนะฝะตัะฐ
    โโโ setup_apache.sh           # ะะฐัััะพะนะบะฐ Apache reverse proxy
```

## ๐ ะัััััะน ััะฐัั

### ะกะฟะพัะพะฑ 1: ะะฒัะพะผะฐัะธัะตัะบะฐั ัััะฐะฝะพะฒะบะฐ (ัะตะบะพะผะตะฝะดัะตััั)

1. **ะะฐะณััะทะธัะต ะฟัะพะตะบั ะฝะฐ ัะตัะฒะตั:**
```bash
# ะะฐ ะฒะฐัะตะผ ะปะพะบะฐะปัะฝะพะผ ะบะพะผะฟัััะตัะต
scp -r wireguard-vpn root@31.28.27.96:/tmp/

# ะะพะดะบะปััะธัะตัั ะบ ัะตัะฒะตัั
ssh root@31.28.27.96

# ะะตัะตะนะดะธัะต ะฒ ะบะฐัะฐะปะพะณ ะฟัะพะตะบัะฐ
cd /tmp/wireguard-vpn
```

2. **ะะฐะฟัััะธัะต ัััะฐะฝะพะฒะบั:**
```bash
chmod +x install.sh scripts/*.sh
./install.sh
```

ะกะบัะธะฟั ะฐะฒัะพะผะฐัะธัะตัะบะธ:
- ะฃััะฐะฝะพะฒะธั Docker ะธ Docker Compose Plugin
- ะะฐัััะพะธั IP forwarding ะธ ัะฐะนัะฒะพะป
- ะะฐะทะฒะตัะฝะตั WireGuard VPN ะบะพะฝัะตะนะฝะตั
- ะะฐัััะพะธั Apache reverse proxy ั Basic Auth

### ะกะฟะพัะพะฑ 2: ะะพัะฐะณะพะฒะฐั ัััะฐะฝะพะฒะบะฐ

#### ะจะฐะณ 1: ะฃััะฐะฝะพะฒะบะฐ Docker
```bash
chmod +x scripts/install_docker.sh
./scripts/install_docker.sh
newgrp docker  # ะัะธะผะตะฝะธัั ะฟัะฐะฒะฐ ะณััะฟะฟั
```

#### ะจะฐะณ 2: ะะฐัััะพะนะบะฐ ัะธััะตะผั
```bash
chmod +x scripts/setup_system.sh
./scripts/setup_system.sh
```

#### ะจะฐะณ 3: ะะฐะทะฒะตัััะฒะฐะฝะธะต VPN
```bash
chmod +x scripts/deploy_vpn.sh
./scripts/deploy_vpn.sh
```

#### ะจะฐะณ 4: ะะฐัััะพะนะบะฐ Apache
```bash
chmod +x scripts/setup_apache.sh
./scripts/setup_apache.sh
```

## โ๏ธ ะะพะฝัะธะณััะฐัะธั

### ะะตัะตะผะตะฝะฝัะต ะพะบััะถะตะฝะธั (.env)

```bash
# IP-ะฐะดัะตั ะธะปะธ ะดะพะผะตะฝ ัะตัะฒะตัะฐ
WG_HOST=31.28.27.96

# UDP ะฟะพัั ะดะปั WireGuard
WG_PORT=51820

# ะะฐะทัะตัะตะฝะฝัะต IP (0.0.0.0/0 = ะฒะตัั ััะฐัะธะบ)
WG_ALLOWED_IPS=0.0.0.0/0,::/0

# DNS ัะตัะฒะตัั ะดะปั ะบะปะธะตะฝัะพะฒ
WG_DEFAULT_DNS=1.1.1.1,9.9.9.9

# MTU
WG_MTU=1280

# Keepalive (ัะตะบัะฝะดั)
WG_PERSISTENT_KEEPALIVE=25

# ะะฐัะพะปั ะฒะตะฑ-ะฟะฐะฝะตะปะธ
ADMIN_PASSWORD=9334138
```

### ะะพััั

- **51820/udp** - WireGuard VPN ััะฝะฝะตะปั
- **51821/tcp** - ะะตะฑ-ะฟะฐะฝะตะปั ะฐะดะผะธะฝะธัััะฐัะพัะฐ (ัะพะปัะบะพ localhost)
- **80/tcp** - Apache HTTP (ะฟัะฑะปะธัะฝัะน ะดะพัััะฟ ะบ /vpn-admin)

## ๐ ะะพัััะฟ ะบ ะฟะฐะฝะตะปะธ ัะฟัะฐะฒะปะตะฝะธั

ะะพัะปะต ััะฟะตัะฝะพะน ัััะฐะฝะพะฒะบะธ:

**URL**: http://31.28.27.96/vpn-admin

**Basic Auth**:
- ะะพะณะธะฝ: `admin`
- ะะฐัะพะปั: (ัะพั, ััะพ ะฒั ัััะฐะฝะพะฒะธะปะธ ะฟัะธ ะฒัะฟะพะปะฝะตะฝะธะธ `setup_apache.sh`)

**ะะฐะฝะตะปั WireGuard**:
- ะะฐัะพะปั: `9334138`

## ๐ฑ ะะพะดะบะปััะตะฝะธะต ะบะปะธะตะฝัะพะฒ

1. ะัะบัะพะนัะต ะฒะตะฑ-ะฟะฐะฝะตะปั ะฟะพ ะฐะดัะตัั http://31.28.27.96/vpn-admin
2. ะะพะนะดะธัะต ะธัะฟะพะปัะทัั Basic Auth ะธ ะฟะฐัะพะปั ะฟะฐะฝะตะปะธ
3. ะะฐะถะผะธัะต "New Client" ะธ ะฒะฒะตะดะธัะต ะธะผั ะบะปะธะตะฝัะฐ
4. ะกะบะฐัะฐะนัะต ะบะพะฝัะธะณััะฐัะธะพะฝะฝัะน ัะฐะนะป ะธะปะธ ะพััะบะฐะฝะธััะนัะต QR-ะบะพะด
5. ะะผะฟะพััะธััะนัะต ะบะพะฝัะธะณััะฐัะธั ะฒ WireGuard ะบะปะธะตะฝั:
   - **Windows/Mac/Linux**: https://www.wireguard.com/install/
   - **iOS**: WireGuard ะธะท App Store
   - **Android**: WireGuard ะธะท Google Play

## ๐ง ะฃะฟัะฐะฒะปะตะฝะธะต ัะตัะฒะธัะพะผ

### ะัะพัะผะพัั ััะฐัััะฐ ะบะพะฝัะตะนะฝะตัะฐ
```bash
docker ps
docker logs wg-easy
```

### ะะตัะตะทะฐะฟััะบ VPN ัะตัะฒะธัะฐ
```bash
cd /opt/vpn
docker compose restart
```

### ะััะฐะฝะพะฒะบะฐ VPN ัะตัะฒะธัะฐ
```bash
cd /opt/vpn
docker compose down
```

### ะะฐะฟััะบ VPN ัะตัะฒะธัะฐ
```bash
cd /opt/vpn
docker compose up -d
```

### ะัะพัะผะพัั ะบะพะฝัะธะณััะฐัะธะธ WireGuard
```bash
ls -la /opt/vpn/config/
```

### ะัะพัะผะพัั ะปะพะณะพะฒ Apache
```bash
sudo tail -f /var/log/apache2/vpn-admin-access.log
sudo tail -f /var/log/apache2/vpn-admin-error.log
```

## ๐ ะะฐัััะพะนะบะฐ HTTPS (ะพะฟัะธะพะฝะฐะปัะฝะพ)

ะะพัะปะต ะฟะพะปััะตะฝะธั ะดะพะผะตะฝะฝะพะณะพ ะธะผะตะฝะธ ะฒั ะผะพะถะตัะต ะฝะฐัััะพะธัั HTTPS:

1. **ะฃััะฐะฝะพะฒะธัะต Certbot:**
```bash
sudo apt install certbot python3-certbot-apache
```

2. **ะะพะปััะธัะต SSL ัะตััะธัะธะบะฐั:**
```bash
sudo certbot --apache -d ะฒะฐั-ะดะพะผะตะฝ.ru
```

3. **ะะฑะฝะพะฒะธัะต ะบะพะฝัะธะณััะฐัะธั:**
- ะัะบัะพะนัะต `/etc/apache2/sites-available/vpn-admin.conf`
- ะะทะผะตะฝะธัะต `ServerName` ะฝะฐ ะฒะฐั ะดะพะผะตะฝ
- Certbot ะฐะฒัะพะผะฐัะธัะตัะบะธ ะฝะฐัััะพะธั SSL

## ๐ก๏ธ ะะตะทะพะฟะฐัะฝะพััั

- โ ะะตะฑ-ะฟะฐะฝะตะปั ะทะฐัะธัะตะฝะฐ Basic Authentication
- โ ะะตะฑ-ะฟะฐะฝะตะปั ะดะพัััะฟะฝะฐ ัะพะปัะบะพ ัะตัะตะท Apache reverse proxy
- โ ะะพะฝัะตะนะฝะตั ะธะทะพะปะธัะพะฒะฐะฝ ะพั ะพัะฝะพะฒะฝะพะน ัะธััะตะผั
- โ WireGuard ะธัะฟะพะปัะทัะตั ัะพะฒัะตะผะตะฝะฝะพะต ัะธััะพะฒะฐะฝะธะต
- โ๏ธ ะะตะบะพะผะตะฝะดัะตััั ะฝะฐัััะพะธัั HTTPS ะดะปั ะดะพะฟะพะปะฝะธัะตะปัะฝะพะน ะทะฐัะธัั
- โ๏ธ ะัะฟะพะปัะทัะนัะต ัะปะพะถะฝัะน ะฟะฐัะพะปั ะดะปั Basic Auth
- โ๏ธ ะะตะณัะปััะฝะพ ะพะฑะฝะพะฒะปัะนัะต ัะธััะตะผั ะธ Docker ะพะฑัะฐะทั

## ๐ ะฃัััะฐะฝะตะฝะธะต ะฝะตะฟะพะปะฐะดะพะบ

### ะะพะฝัะตะนะฝะตั ะฝะต ะทะฐะฟััะบะฐะตััั
```bash
# ะัะพะฒะตัััะต ะปะพะณะธ
docker logs wg-easy

# ะัะพะฒะตัััะต ะฟะพััั
sudo ss -lunp | grep 51820
sudo ss -lnp | grep 51821
```

### ะะตะฑ-ะฟะฐะฝะตะปั ะฝะตะดะพัััะฟะฝะฐ
```bash
# ะัะพะฒะตัััะต ััะฐััั Apache
sudo systemctl status apache2

# ะัะพะฒะตัััะต ะบะพะฝัะธะณััะฐัะธั
sudo apache2ctl configtest

# ะัะพะฒะตัััะต ะปะพะณะธ
sudo tail -f /var/log/apache2/error.log
```

### ะะปะธะตะฝัั ะฝะต ะผะพะณัั ะฟะพะดะบะปััะธัััั
```bash
# ะัะพะฒะตัััะต IP forwarding
sudo sysctl net.ipv4.ip_forward
sudo sysctl net.ipv6.conf.all.forwarding

# ะัะพะฒะตัััะต ัะฐะนัะฒะพะป
sudo ufw status
sudo iptables -L -n -v
```

### ะะฑะฝะพะฒะปะตะฝะธะต ะบะพะฝัะตะนะฝะตัะฐ
```bash
cd /opt/vpn
docker compose pull
docker compose up -d
```

## ๐ ะะพะฝะธัะพัะธะฝะณ

### ะัะพัะผะพัั ะฟะพะดะบะปััะตะฝะฝัั ะบะปะธะตะฝัะพะฒ
ะงะตัะตะท ะฒะตะฑ-ะฟะฐะฝะตะปั: http://31.28.27.96/vpn-admin

### ะกัะฐัะธััะธะบะฐ ะธัะฟะพะปัะทะพะฒะฐะฝะธั
```bash
docker stats wg-easy
```

### ะัะฟะพะปัะทะพะฒะฐะฝะธะต ะดะธัะบะฐ
```bash
du -sh /opt/vpn/config/
```

## ๐ ะะตะทะตัะฒะฝะพะต ะบะพะฟะธัะพะฒะฐะฝะธะต

### ะกะพะทะดะฐะฝะธะต ะฑัะบะฐะฟะฐ ะบะพะฝัะธะณััะฐัะธะธ
```bash
sudo tar -czf wireguard-backup-$(date +%Y%m%d).tar.gz /opt/vpn/config/
```

### ะะพัััะฐะฝะพะฒะปะตะฝะธะต ะธะท ะฑัะบะฐะฟะฐ
```bash
cd /opt/vpn
sudo tar -xzf wireguard-backup-YYYYMMDD.tar.gz -C /
docker compose restart
```

## ๐ ะัะธะผะตัะฐะฝะธั

- ะญัะพั VPN ัะตัะฒะตั ะฝะต ะทะฐััะฐะณะธะฒะฐะตั ัััะตััะฒัััะธะต ัะตัะฒะธัั (Apache2, PM2, Childwatch)
- ะัะต ะดะฐะฝะฝัะต VPN ััะฐะฝัััั ะฒ `/opt/vpn/config/`
- ะะพะฝัะตะนะฝะตั ะฐะฒัะพะผะฐัะธัะตัะบะธ ะฟะตัะตะทะฐะฟััะบะฐะตััั ะฟัะธ ะฟะตัะตะทะฐะณััะทะบะต ัะตัะฒะตัะฐ (`restart: unless-stopped`)

## ๐ ะะพะฟะพะปะฝะธัะตะปัะฝัะต ัะตััััั

- [WireGuard ะพัะธัะธะฐะปัะฝะฐั ะดะพะบัะผะตะฝัะฐัะธั](https://www.wireguard.com/)
- [wg-easy GitHub](https://github.com/WeeJeWel/wg-easy)
- [Docker ะดะพะบัะผะตะฝัะฐัะธั](https://docs.docker.com/)

## ๐ ะะธัะตะฝะทะธั

MIT License

## ๐ค ะะฒัะพั

DREDGV - https://github.com/DREDGV

## ๐ค ะะพะดะดะตัะถะบะฐ

ะัะปะธ ั ะฒะฐั ะฒะพะทะฝะธะบะปะธ ะฟัะพะฑะปะตะผั, ัะพะทะดะฐะนัะต Issue ะฒ GitHub ัะตะฟะพะทะธัะพัะธะธ.

---

**ะะตััะธั**: 1.0.0
**ะะฐัะฐ**: 2025-01-26
