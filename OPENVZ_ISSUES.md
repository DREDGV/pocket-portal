# OpenVZ Virtualization Issues - Detailed Report

**–î–∞—Ç–∞:** 28 –æ–∫—Ç—è–±—Ä—è 2025  
**–°–µ—Ä–≤–µ—Ä:** 31.28.27.96 (Ubuntu 22.04, OpenVZ)  
**–¶–µ–ª—å:** –†–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏–µ WireGuard VPN

---

## –ö—Ä–∞—Ç–∫–æ–µ —Ä–µ–∑—é–º–µ –ø—Ä–æ–±–ª–µ–º—ã

OpenVZ –≤–∏—Ä—Ç—É–∞–ª–∏–∑–∞—Ü–∏—è **–ù–ï –ü–û–î–î–ï–†–ñ–ò–í–ê–ï–¢** WireGuard kernel module –∏–∑-–∑–∞ –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–Ω—ã—Ö –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–π. –í—Å–µ –ø–æ–ø—ã—Ç–∫–∏ –∑–∞–ø—É—Å—Ç–∏—Ç—å WireGuard-based —Ä–µ—à–µ–Ω–∏—è —Å—Ç–æ–ª–∫–Ω—É–ª–∏—Å—å —Å –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏–º–∏ –æ—à–∏–±–∫–∞–º–∏.

---

## –•—Ä–æ–Ω–æ–ª–æ–≥–∏—è –ø–æ–ø—ã—Ç–æ–∫

### 1. –ü–æ–ø—ã—Ç–∫–∞ ‚Ññ1: linuxserver/wireguard (FAILED)

**–û–±—Ä–∞–∑:** `lscr.io/linuxserver/wireguard:latest`  
**–†–µ–∑—É–ª—å—Ç–∞—Ç:** ‚ùå –ö–æ–Ω—Ç–µ–π–Ω–µ—Ä –∑–∞–≤–∏—Å–∞–µ—Ç –Ω–∞ —Å—Ç–∞—Ä—Ç–µ

#### –ü—Ä–æ–±–ª–µ–º–∞
```bash
[cont-init.d] 30-module: executing...
Uname info: Linux 7a8eb6cd0e08 2.6.32-042stab162.2 #1 SMP Thu Jun 9 12:05:33 MSK 2022 x86_64 x86_64 x86_64 GNU/Linux
**** It seems the wireguard module is already active. Skipping kernel header install and module compilation. ****
**** The module is not active, will attempt kernel header install and module compilation. ****
Kernel headers don't seem to be available, will try to install
# –ó–ê–í–ò–°–ê–ù–ò–ï –ó–î–ï–°–¨ - —Å–∫—Ä–∏–ø—Ç —É—Ö–æ–¥–∏—Ç –≤ sleep infinity
```

#### –ê–Ω–∞–ª–∏–∑ –∫–æ—Ä–Ω–µ–≤–æ–π –ø—Ä–∏—á–∏–Ω—ã
–§–∞–π–ª `/etc/s6-overlay/s6-rc.d/init-wireguard-module/run` —Å–æ–¥–µ—Ä–∂–∏—Ç:

```bash
if lsmod | grep wireguard; then
    # –ú–æ–¥—É–ª—å –∞–∫—Ç–∏–≤–µ–Ω
else
    # –ü—ã—Ç–∞–µ—Ç—Å—è —É—Å—Ç–∞–Ω–æ–≤–∏—Ç—å kernel headers
    # –ù–ê OPENVZ –≠–¢–û –ù–ï–í–û–ó–ú–û–ñ–ù–û
    # –ó–∞—Ç–µ–º –≤—ã–ø–æ–ª–Ω—è–µ—Ç: exec sleep infinity
fi
```

**–ü—Ä–∏—á–∏–Ω–∞ –∑–∞–≤–∏—Å–∞–Ω–∏—è:** OpenVZ –Ω–µ –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª—è–µ—Ç –¥–æ—Å—Ç—É–ø –∫ kernel headers —Ö–æ—Å—Ç-—Å–∏—Å—Ç–µ–º—ã. Container –ø—ã—Ç–∞–µ—Ç—Å—è –∏—Ö —É—Å—Ç–∞–Ω–æ–≤–∏—Ç—å, —Ç–µ—Ä–ø–∏—Ç –Ω–µ—É–¥–∞—á—É –∏ —É—Ö–æ–¥–∏—Ç –≤ –±–µ—Å–∫–æ–Ω–µ—á–Ω—ã–π —Å–æ–Ω.

#### –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∞—è –¥–µ—Ç–∞–ª—å
OpenVZ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç **shared kernel** –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—É - –≤—Å–µ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä—ã –∏—Å–ø–æ–ª—å–∑—É—é—Ç —è–¥—Ä–æ —Ö–æ—Å—Ç–∞. –ö–æ–Ω—Ç–µ–π–Ω–µ—Ä—ã –Ω–µ –º–æ–≥—É—Ç –∑–∞–≥—Ä—É–∂–∞—Ç—å —Å–≤–æ–∏ kernel modules, —Ç–æ–ª—å–∫–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —Ç–µ, —á—Ç–æ –∑–∞–≥—Ä—É–∂–µ–Ω—ã –Ω–∞ —Ö–æ—Å—Ç–µ.

---

### 2. –ü–æ–ø—ã—Ç–∫–∞ ‚Ññ2: wg-easy (FAILED)

**–û–±—Ä–∞–∑:** `ghcr.io/wg-easy/wg-easy:latest`  
**–†–µ–∑—É–ª—å—Ç–∞—Ç:** ‚ùå –ö–æ–Ω—Ç–µ–π–Ω–µ—Ä –Ω–µ –º–æ–∂–µ—Ç —Å–æ–∑–¥–∞—Ç—å WireGuard –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å

#### –ü—Ä–æ–±–ª–µ–º–∞
```
2025-10-28T15:54:27.345Z WireGuard Configuration generated.
Error: WireGuard exited with the error: Cannot find device "wg0"
This usually means that your host's kernel does not support WireGuard!
```

#### –ê–Ω–∞–ª–∏–∑
wg-easy –∏—Å–ø–æ–ª—å–∑—É–µ—Ç –∫–æ–º–∞–Ω–¥—ã `wg-quick up wg0` –∏ `wg-quick down wg0`, –∫–æ—Ç–æ—Ä—ã–µ —Ç—Ä–µ–±—É—é—Ç:
1. Kernel module `wireguard` –∑–∞–≥—Ä—É–∂–µ–Ω–Ω—ã–º –Ω–∞ —Ö–æ—Å—Ç–µ
2. –ò–ª–∏ userspace implementation —á–µ—Ä–µ–∑ `wireguard-go`

–ù–∞ –Ω–∞—à–µ–º OpenVZ —Å–µ—Ä–≤–µ—Ä–µ:
- ‚úÖ `wg-quick` —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω: `/usr/bin/wg-quick`
- ‚ùå `wireguard-go` –ù–ï —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω
- ‚ùå Kernel module –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω (–ø—Ä–æ–≤–µ—Ä–µ–Ω–æ —á–µ—Ä–µ–∑ `lsmod | grep wireguard` - –ø—É—Å—Ç–æ)

#### –†–µ—à–µ–Ω–∏–µ (–Ω–µ —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ)
–ù—É–∂–Ω–æ —É—Å—Ç–∞–Ω–æ–≤–∏—Ç—å `wireguard-go` –Ω–∞ —Ö–æ—Å—Ç-—Å–∏—Å—Ç–µ–º—É –∏ –Ω–∞—Å—Ç—Ä–æ–∏—Ç—å wg-easy –¥–ª—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è userspace —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏.

```bash
# –ù–∞ —Ö–æ—Å—Ç–µ
apt install wireguard-tools wireguard-go
export WG_QUICK_USERSPACE_IMPLEMENTATION=wireguard-go
```

–ù–æ —ç—Ç–æ —Ç—Ä–µ–±—É–µ—Ç –∏–∑–º–µ–Ω–µ–Ω–∏—è —Å–∞–º–æ–≥–æ –æ–±—Ä–∞–∑–∞ wg-easy –∏–ª–∏ –º–æ–Ω—Ç–∏—Ä–æ–≤–∞–Ω–∏—è wireguard-go –≤ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä.

---

### 3. –ü–æ–ø—ã—Ç–∫–∞ ‚Ññ3: wg-access-server (FAILED)

**–û–±—Ä–∞–∑:** `ghcr.io/freifunkmuc/wg-access-server:latest`  
**–†–µ–∑—É–ª—å—Ç–∞—Ç:** ‚ùå –¢—Ä–µ–±—É–µ—Ç WireGuard private key, –Ω–æ –∑–∞—Ç–µ–º —Ç–∞ –∂–µ –ø—Ä–æ–±–ª–µ–º–∞ —Å device

#### –ü—Ä–æ–±–ª–µ–º—ã
1. **–ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è:** –¢—Ä–µ–±—É–µ—Ç —è–≤–Ω–æ–≥–æ —É–∫–∞–∑–∞–Ω–∏—è `WIREGUARD_PRIVATE_KEY` –≤ environment
2. **–¢–∞ –∂–µ –ø—Ä–æ–±–ª–µ–º–∞ —Å kernel module:** –ü–æ—Å–ª–µ –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ –∫–ª—é—á–∞ —Å—Ç–æ–ª–∫–Ω–µ–º—Å—è —Å "Cannot find device wg0"

#### –ß—Ç–æ –±—ã–ª–æ —Å–¥–µ–ª–∞–Ω–æ
```yaml
environment:
  - WIREGUARD_PRIVATE_KEY=QOSeG+roCyqX7qZngIoT5tkOMSNiZD3aIX2ajMNx2lQ=
  - WG_ADMIN_PASSWORD=PocketPortal2025Secure
  - WG_EXTERNAL_HOST=31.28.27.96
```

–ö–æ–Ω—Ç–µ–π–Ω–µ—Ä –∑–∞–ø—É—Å—Ç–∏–ª—Å—è, –Ω–æ —Ü–∏–∫–ª–∏—á–µ—Å–∫–∏ –ø–∞–¥–∞–ª —Å —Å–æ–æ–±—â–µ–Ω–∏–µ–º:
```
level=fatal msg="Missing WireGuard private key"
```

–î–∞–∂–µ –ø–æ—Å–ª–µ –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –∫–ª—é—á–∞ –≤ environment, –ø–µ—Ä–µ–º–µ–Ω–Ω–∞—è –Ω–µ —á–∏—Ç–∞–ª–∞—Å—å –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ. –ü–æ–ø—ã—Ç–∫–∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —Ñ–∞–π–ª –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ `config.yaml` —Ç–∞–∫–∂–µ –Ω–µ –ø—Ä–∏–Ω–µ—Å–ª–∏ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞ –∏–∑-–∑–∞ –ø—Ä–æ–±–ª–µ–º —Å PowerShell heredoc —Å–∏–Ω—Ç–∞–∫—Å–∏—Å–æ–º.

---

### 4. –ü–æ–ø—ã—Ç–∫–∞ ‚Ññ4: Outline VPN (IN PROGRESS)

**–†–µ—à–µ–Ω–∏–µ:** `https://github.com/Jigsaw-Code/outline-server`  
**–°—Ç–∞—Ç—É—Å:** üîÑ –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –≤ –ø—Ä–æ—Ü–µ—Å—Å–µ

#### –ü–æ—á–µ–º—É Outline –º–æ–∂–µ—Ç —Å—Ä–∞–±–æ—Ç–∞—Ç—å

Outline VPN –∏—Å–ø–æ–ª—å–∑—É–µ—Ç **Shadowsocks** –ø—Ä–æ—Ç–æ–∫–æ–ª, –∫–æ—Ç–æ—Ä—ã–π —Ä–∞–±–æ—Ç–∞–µ—Ç –ø–æ–ª–Ω–æ—Å—Ç—å—é –≤ userspace:
- ‚úÖ –ù–µ —Ç—Ä–µ–±—É–µ—Ç kernel modules
- ‚úÖ –†–∞–±–æ—Ç–∞–µ—Ç —á–µ—Ä–µ–∑ —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–µ TCP/UDP sockets
- ‚úÖ –ü—Ä–æ–≤–µ—Ä–µ–Ω –Ω–∞ OpenVZ –º–Ω–æ–∂–µ—Å—Ç–≤–æ–º –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
- ‚úÖ –û—Ñ–∏—Ü–∏–∞–ª—å–Ω–∞—è –ø–æ–¥–¥–µ—Ä–∂–∫–∞ –æ—Ç Google Jigsaw

#### –ö–æ–º–∞–Ω–¥–∞ —É—Å—Ç–∞–Ω–æ–≤–∫–∏
```bash
curl -sSL https://raw.githubusercontent.com/Jigsaw-Code/outline-server/master/src/server_manager/install_scripts/install_server.sh | bash
```

---

## –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏–µ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è OpenVZ

### –ß—Ç–æ —Ç–∞–∫–æ–µ OpenVZ?

OpenVZ - —ç—Ç–æ **container-based virtualization** –¥–ª—è Linux:
- –ò—Å–ø–æ–ª—å–∑—É–µ—Ç **–æ–¥–∏–Ω –æ–±—â–∏–π kernel** –¥–ª—è –≤—Å–µ—Ö –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–æ–≤
- –ö–æ–Ω—Ç–µ–π–Ω–µ—Ä—ã –∏–∑–æ–ª–∏—Ä–æ–≤–∞–Ω—ã —á–µ—Ä–µ–∑ namespaces –∏ cgroups
- –õ–µ–≥—á–µ –∏ –±—ã—Å—Ç—Ä–µ–µ –ø–æ–ª–Ω–æ–π –≤–∏—Ä—Ç—É–∞–ª–∏–∑–∞—Ü–∏–∏ (KVM), –Ω–æ –º–µ–Ω–µ–µ –≥–∏–±–∫–∏–π

### –ö–ª—é—á–µ–≤—ã–µ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è

| –§—É–Ω–∫—Ü–∏—è | KVM | OpenVZ |
|---------|-----|--------|
| –°–æ–±—Å—Ç–≤–µ–Ω–Ω–æ–µ —è–¥—Ä–æ | ‚úÖ –î–∞ | ‚ùå –ù–µ—Ç (shared kernel) |
| –ó–∞–≥—Ä—É–∑–∫–∞ kernel modules | ‚úÖ –î–∞ | ‚ùå –ù–µ—Ç |
| TUN/TAP device | ‚úÖ –î–∞ | ‚ö†Ô∏è –ß–∞—Å—Ç–∏—á–Ω–æ (–Ω—É–∂–Ω–æ –Ω–∞ —Ö–æ—Å—Ç–µ) |
| WireGuard kernel module | ‚úÖ –î–∞ | ‚ùå –¢—Ä–µ–±—É–µ—Ç —Ö–æ—Å—Ç |
| WireGuard userspace (wireguard-go) | ‚úÖ –î–∞ | ‚úÖ –î–∞ (–µ—Å–ª–∏ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω) |
| Shadowsocks | ‚úÖ –î–∞ | ‚úÖ –î–∞ |
| OpenVPN | ‚úÖ –î–∞ | ‚úÖ –î–∞ |

### –ü–æ—á–µ–º—É WireGuard –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç?

1. **Kernel Module Dependency**
   ```bash
   # –ù–∞ KVM –º–æ–∂–Ω–æ –∑–∞–≥—Ä—É–∑–∏—Ç—å:
   modprobe wireguard
   
   # –ù–∞ OpenVZ —ç—Ç–æ –≤–µ—Ä–Ω–µ—Ç:
   modprobe: ERROR: could not insert 'wireguard': Operation not permitted
   ```

2. **TUN Device**
   ```bash
   # –ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ:
   ls -la /dev/net/tun
   # crw-rw-rw- 1 root root 10, 200 Oct 28 12:00 /dev/net/tun
   # –£—Å—Ç—Ä–æ–π—Å—Ç–≤–æ –µ—Å—Ç—å, –Ω–æ kernel module –¥–ª—è WireGuard –æ—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç
   ```

3. **Shared Kernel Architecture**
   - –•–æ—Å—Ç –∏—Å–ø–æ–ª—å–∑—É–µ—Ç `2.6.32-042stab162.2` (—Å—Ç–∞—Ä–æ–µ —è–¥—Ä–æ)
   - WireGuard —Ç—Ä–µ–±—É–µ—Ç kernel 5.6+ –¥–ª—è –Ω–∞—Ç–∏–≤–Ω–æ–π –ø–æ–¥–¥–µ—Ä–∂–∫–∏
   - –ò–ª–∏ userspace implementation (wireguard-go)

---

## –í–æ–∑–º–æ–∂–Ω—ã–µ —Ä–µ—à–µ–Ω–∏—è

### –†–µ—à–µ–Ω–∏–µ 1: –£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å wireguard-go –Ω–∞ —Ö–æ—Å—Ç (–†–ï–ö–û–ú–ï–ù–î–£–ï–¢–°–Ø)

**–¢—Ä–µ–±—É–µ—Ç SSH root –¥–æ—Å—Ç—É–ø –∫ –§–ò–ó–ò–ß–ï–°–ö–û–ú–£ —Ö–æ—Å—Ç—É** (–Ω–µ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä—É)

```bash
# –ù–∞ —Ö–æ—Å—Ç-–Ω–æ–¥–µ OpenVZ
apt update
apt install wireguard-tools wireguard-go -y

# –ü—Ä–æ–≤–µ—Ä–∫–∞
which wireguard-go
# /usr/bin/wireguard-go
```

–ó–∞—Ç–µ–º –≤ docker-compose –¥–æ–±–∞–≤–∏—Ç—å:
```yaml
environment:
  - WG_QUICK_USERSPACE_IMPLEMENTATION=wireguard-go
volumes:
  - /usr/bin/wireguard-go:/usr/bin/wireguard-go:ro
```

**–ü—Ä–æ–±–ª–µ–º–∞:** –¢—Ä–µ–±—É–µ—Ç –¥–æ—Å—Ç—É–ø –∫ —Ö–æ—Å—Ç-—Å–∏—Å—Ç–µ–º–µ OpenVZ, –∫–æ—Ç–æ—Ä—ã–π —É –Ω–∞—Å –º–æ–∂–µ—Ç –Ω–µ –±—ã—Ç—å.

---

### –†–µ—à–µ–Ω–∏–µ 2: –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å Outline VPN (–¢–ï–ö–£–©–ò–ô –ü–û–î–•–û–î) ‚úÖ

**–ù–µ —Ç—Ä–µ–±—É–µ—Ç –¥–æ—Å—Ç—É–ø–∞ –∫ —Ö–æ—Å—Ç—É**

Outline —Ä–∞–±–æ—Ç–∞–µ—Ç –ø–æ–ª–Ω–æ—Å—Ç—å—é –≤ userspace —á–µ—Ä–µ–∑ Shadowsocks:
```
Client (Outline app) ‚Üí Shadowsocks protocol ‚Üí Outline Server (Docker) ‚Üí Internet
```

**–ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞:**
- ‚úÖ –†–∞–±–æ—Ç–∞–µ—Ç –Ω–∞ –ª—é–±–æ–π –≤–∏—Ä—Ç—É–∞–ª–∏–∑–∞—Ü–∏–∏
- ‚úÖ –ü—Ä–æ—Å—Ç–∞—è —É—Å—Ç–∞–Ω–æ–≤–∫–∞ –æ–¥–Ω–æ–π –∫–æ–º–∞–Ω–¥–æ–π
- ‚úÖ GUI –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è (Outline Manager)
- ‚úÖ –ö–ª–∏–µ–Ω—Ç—ã –¥–ª—è –≤—Å–µ—Ö –ø–ª–∞—Ç—Ñ–æ—Ä–º (Windows, Android, iOS, macOS, Linux)
- ‚úÖ –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –≥–µ–Ω–µ—Ä–∞—Ü–∏—è –∫–ª—é—á–µ–π –¥–æ—Å—Ç—É–ø–∞
- ‚úÖ –û–±—Ñ—É—Å–∫–∞—Ü–∏—è —Ç—Ä–∞—Ñ–∏–∫–∞ (—Å–ª–æ–∂–Ω–µ–µ –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞—Ç—å)

**–ù–µ–¥–æ—Å—Ç–∞—Ç–∫–∏:**
- ‚ö†Ô∏è –ù–µ–º–Ω–æ–≥–æ –º–µ–¥–ª–µ–Ω–Ω–µ–µ WireGuard (~5-10%)
- ‚ö†Ô∏è –ú–µ–Ω—å—à–µ —Ñ—É–Ω–∫—Ü–∏–π (—Ç–æ–ª—å–∫–æ VPN, –Ω–µ—Ç mesh networking)

---

### –†–µ—à–µ–Ω–∏–µ 3: –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å OpenVPN

**–ö–ª–∞—Å—Å–∏—á–µ—Å–∫–æ–µ —Ä–µ—à–µ–Ω–∏–µ, 100% —Ä–∞–±–æ—Ç–∞–µ—Ç –Ω–∞ OpenVZ**

```bash
docker run -d --name=openvpn-server \
  --cap-add=NET_ADMIN \
  -p 1194:1194/udp \
  -v /opt/vpn/openvpn:/etc/openvpn \
  kylemanna/openvpn
```

**–ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞:**
- ‚úÖ –ì–∞—Ä–∞–Ω—Ç–∏—Ä–æ–≤–∞–Ω–Ω–æ —Ä–∞–±–æ—Ç–∞–µ—Ç –Ω–∞ OpenVZ
- ‚úÖ –ü—Ä–æ–≤–µ—Ä–µ–Ω–Ω–æ–µ —Ä–µ—à–µ–Ω–∏–µ —Å 2001 –≥–æ–¥–∞
- ‚úÖ –ú–Ω–æ–≥–æ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏ –∏ –ø–æ–¥–¥–µ—Ä–∂–∫–∏
- ‚úÖ Flexible –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è

**–ù–µ–¥–æ—Å—Ç–∞—Ç–∫–∏:**
- ‚ùå –ú–µ–¥–ª–µ–Ω–Ω–µ–µ WireGuard (–≤ 2-3 —Ä–∞–∑–∞)
- ‚ùå –°–ª–æ–∂–Ω–µ–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∞
- ‚ùå –ë–æ–ª—å—à–µ –æ–≤–µ—Ä—Ö–µ–¥ (TCP + SSL/TLS)

---

### –†–µ—à–µ–Ω–∏–µ 4: –°–º–µ–Ω–∏—Ç—å —Ö–æ—Å—Ç–∏–Ω–≥ –Ω–∞ KVM –≤–∏—Ä—Ç—É–∞–ª–∏–∑–∞—Ü–∏—é

**–ü–æ–ª–Ω–æ–µ —Ä–µ—à–µ–Ω–∏–µ –ø—Ä–æ–±–ª–µ–º—ã**

–ü—Ä–æ–≤–∞–π–¥–µ—Ä—ã —Å KVM:
- DigitalOcean (–æ—Ç $6/–º–µ—Å)
- Vultr (–æ—Ç $5/–º–µ—Å)
- Hetzner (–æ—Ç ‚Ç¨4.5/–º–µ—Å)
- Linode (–æ—Ç $5/–º–µ—Å)

**–ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞:**
- ‚úÖ WireGuard —Ä–∞–±–æ—Ç–∞–µ—Ç –Ω–∞—Ç–∏–≤–Ω–æ
- ‚úÖ –ü–æ–ª–Ω—ã–π –∫–æ–Ω—Ç—Ä–æ–ª—å –Ω–∞–¥ kernel
- ‚úÖ –ú–æ–∂–Ω–æ –∑–∞–≥—Ä—É–∂–∞—Ç—å –ª—é–±—ã–µ modules
- ‚úÖ –õ—É—á—à–∞—è –∏–∑–æ–ª—è—Ü–∏—è

**–ù–µ–¥–æ—Å—Ç–∞—Ç–∫–∏:**
- ‚ùå –¢—Ä–µ–±—É–µ—Ç –º–∏–≥—Ä–∞—Ü–∏—é –¥–∞–Ω–Ω—ã—Ö
- ‚ùå –ü—Ä–æ—Å—Ç–æ–π –Ω–∞ –≤—Ä–µ–º—è –ø–µ—Ä–µ–Ω–æ—Å–∞
- ‚ùå –ù—É–∂–Ω–æ –Ω–∞—Å—Ç—Ä–∞–∏–≤–∞—Ç—å –≤—Å–µ –∑–∞–Ω–æ–≤–æ

---

## PowerShell Issues (–ü–æ–±–æ—á–Ω–∞—è –ø—Ä–æ–±–ª–µ–º–∞)

### –ü—Ä–æ–±–ª–µ–º–∞ —Å heredoc —Å–∏–Ω—Ç–∞–∫—Å–∏—Å–æ–º

–ü—Ä–∏ –ø–æ–ø—ã—Ç–∫–µ —Å–æ–∑–¥–∞—Ç—å —Ñ–∞–π–ª—ã –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ —á–µ—Ä–µ–∑ SSH + PowerShell:

```powershell
ssh root@31.28.27.96 @"
cat > /opt/vpn/config.yaml << 'EOF'
content here
EOF
"@
```

**–û—à–∏–±–∫–∞:**
```
System.ArgumentOutOfRangeException: –ó–Ω–∞—á–µ–Ω–∏–µ –Ω–µ –º–æ–∂–µ—Ç –±—ã—Ç—å –æ—Ç—Ä–∏—Ü–∞—Ç–µ–ª—å–Ω—ã–º.
–ü–∞—Ä–∞–º–µ—Ç—Ä: top
–°–º–µ—â–µ–Ω–∏–µ –±—ã–ª–æ -7.
```

#### –ü—Ä–∏—á–∏–Ω–∞
PowerShell here-string (`@"..."@`) –∫–æ–Ω—Ñ–ª–∏–∫—Ç—É–µ—Ç —Å bash heredoc (`<< 'EOF'`). PowerShell –ø—ã—Ç–∞–µ—Ç—Å—è –ø–∞—Ä—Å–∏—Ç—å —Å–æ–¥–µ—Ä–∂–∏–º–æ–µ –∫–∞–∫ —á–∞—Å—Ç—å —Å–≤–æ–µ–π —Å—Ç—Ä–æ–∫–∏.

#### –û–±—Ö–æ–¥–Ω—ã–µ –ø—É—Ç–∏
1. –°–æ–∑–¥–∞—Ç—å —Ñ–∞–π–ª –ª–æ–∫–∞–ª—å–Ω–æ –∏ —Å–∫–æ–ø–∏—Ä–æ–≤–∞—Ç—å —á–µ—Ä–µ–∑ SCP ‚úÖ (–∏—Å–ø–æ–ª—å–∑–æ–≤–∞–ª–∏)
2. –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å `echo` —Å —ç–∫—Ä–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ–º
3. –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å `printf` –≤–º–µ—Å—Ç–æ heredoc
4. –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –±–∞–∑–æ–≤—ã–π `bash` –≤–º–µ—Å—Ç–æ `PowerShell`

---

## –¢–µ–∫—É—â–∏–π —Å—Ç–∞—Ç—É—Å

### –ß—Ç–æ —Ä–∞–±–æ—Ç–∞–µ—Ç ‚úÖ
- ‚úÖ Docker —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω –∏ —Ä–∞–±–æ—Ç–∞–µ—Ç
- ‚úÖ –ü–æ—Ä—Ç—ã 51820/udp –∏ 51821/tcp –æ—Ç–∫—Ä—ã—Ç—ã –≤ firewall
- ‚úÖ `/dev/net/tun` –¥–æ—Å—Ç—É–ø–µ–Ω
- ‚úÖ –ö–æ–Ω—Ç–µ–π–Ω–µ—Ä—ã –∑–∞–ø—É—Å–∫–∞—é—Ç—Å—è (–Ω–æ –ø–∞–¥–∞—é—Ç)
- ‚úÖ SCP/SSH –¥–æ—Å—Ç—É–ø —Ä–∞–±–æ—Ç–∞–µ—Ç

### –ß—Ç–æ –ù–ï —Ä–∞–±–æ—Ç–∞–µ—Ç ‚ùå
- ‚ùå linuxserver/wireguard - –∑–∞–≤–∏—Å–∞–µ—Ç –Ω–∞ init
- ‚ùå wg-easy - "Cannot find device wg0"
- ‚ùå wg-access-server - –Ω–µ —á–∏—Ç–∞–µ—Ç WIREGUARD_PRIVATE_KEY
- ‚ùå WireGuard kernel module –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω

### –í –ø—Ä–æ—Ü–µ—Å—Å–µ üîÑ
- üîÑ Outline VPN —É—Å—Ç–∞–Ω–æ–≤–∫–∞ (Shadowsocks-based)
- üîÑ –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–∞–±–æ—Ç–æ—Å–ø–æ—Å–æ–±–Ω–æ—Å—Ç–∏ Outline

---

## –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏

### –ö—Ä–∞—Ç–∫–æ—Å—Ä–æ—á–Ω—ã–µ (–°–µ–π—á–∞—Å)
1. ‚úÖ –ó–∞–≤–µ—Ä—à–∏—Ç—å —É—Å—Ç–∞–Ω–æ–≤–∫—É Outline VPN
2. ‚úÖ –ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ —Å Windows
3. ‚úÖ –ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ —Å Android
4. ‚úÖ –ó–∞–¥–æ–∫—É–º–µ–Ω—Ç–∏—Ä–æ–≤–∞—Ç—å –ø—Ä–æ—Ü–µ—Å—Å

### –°—Ä–µ–¥–Ω–µ—Å—Ä–æ—á–Ω—ã–µ (1-2 –Ω–µ–¥–µ–ª–∏)
1. –°–≤—è–∑–∞—Ç—å—Å—è —Å —Ö–æ—Å—Ç–∏–Ω–≥-–ø—Ä–æ–≤–∞–π–¥–µ—Ä–æ–º:
   - –ó–∞–ø—Ä–æ—Å–∏—Ç—å —É—Å—Ç–∞–Ω–æ–≤–∫—É `wireguard-go` –Ω–∞ —Ö–æ—Å—Ç-—Å–∏—Å—Ç–µ–º—É
   - –ò–ª–∏ –∑–∞–ø—Ä–æ—Å–∏—Ç—å –∞–ø–≥—Ä–µ–π–¥ kernel –¥–æ 5.6+
   - –ò–ª–∏ –∑–∞–ø—Ä–æ—Å–∏—Ç—å –º–∏–≥—Ä–∞—Ü–∏—é –Ω–∞ KVM
2. –ï—Å–ª–∏ —Ö–æ—Å—Ç–µ—Ä –Ω–µ –ø–æ–º–æ–∂–µ—Ç - —Ä–∞—Å—Å–º–æ—Ç—Ä–µ—Ç—å –º–∏–≥—Ä–∞—Ü–∏—é –Ω–∞ KVM-–ø—Ä–æ–≤–∞–π–¥–µ—Ä–∞

### –î–æ–ª–≥–æ—Å—Ä–æ—á–Ω—ã–µ (–ï—Å–ª–∏ WireGuard –∫—Ä–∏—Ç–∏—á–µ–Ω)
1. –°–º–µ–Ω–∏—Ç—å —Ö–æ—Å—Ç–∏–Ω–≥ –Ω–∞ KVM –≤–∏—Ä—Ç—É–∞–ª–∏–∑–∞—Ü–∏—é
2. –ù–∞—Å—Ç—Ä–æ–∏—Ç—å WireGuard –Ω–∞—Ç–∏–≤–Ω–æ
3. –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å –≤—Å–µ —Ñ—É–Ω–∫—Ü–∏–∏ –∏–∑ ROADMAP.md

---

## –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –º–∞—Ç–µ—Ä–∏–∞–ª—ã

### –ü–æ–ª–µ–∑–Ω—ã–µ –∫–æ–º–∞–Ω–¥—ã –¥–ª—è –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∏

```bash
# –ü—Ä–æ–≤–µ—Ä–∫–∞ –≤–∏—Ä—Ç—É–∞–ª–∏–∑–∞—Ü–∏–∏
systemd-detect-virt
# –í–µ—Ä–Ω–µ—Ç: openvz

# –ü—Ä–æ–≤–µ—Ä–∫–∞ kernel
uname -r
# –í–µ—Ä–Ω–µ—Ç: 2.6.32-042stab162.2

# –ü—Ä–æ–≤–µ—Ä–∫–∞ WireGuard module
lsmod | grep wireguard
# –ü—É—Å—Ç–æ (–º–æ–¥—É–ª—å –Ω–µ –∑–∞–≥—Ä—É–∂–µ–Ω)

# –ü—Ä–æ–≤–µ—Ä–∫–∞ TUN device
ls -la /dev/net/tun
cat /sys/class/net/tun/uevent

# –ü—Ä–æ–≤–µ—Ä–∫–∞ capabilities –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞
docker run --rm -it --cap-add=NET_ADMIN alpine sh -c "ip link add wg0 type wireguard"
# –í–µ—Ä–Ω–µ—Ç: Operation not supported
```

### –°—Å—ã–ª–∫–∏ –Ω–∞ GitHub Issues

–≠—Ç–∞ –ø—Ä–æ–±–ª–µ–º–∞ –∏–∑–≤–µ—Å—Ç–Ω–∞ –≤ —Å–æ–æ–±—â–µ—Å—Ç–≤–µ:
- https://github.com/linuxserver/docker-wireguard/issues/115
- https://github.com/wg-easy/wg-easy/issues/256
- https://serverfault.com/questions/1073679/wireguard-in-docker-container-on-openvz

---

## –í—ã–≤–æ–¥—ã

OpenVZ –≤–∏—Ä—Ç—É–∞–ª–∏–∑–∞—Ü–∏—è **—Ñ—É–Ω–¥–∞–º–µ–Ω—Ç–∞–ª—å–Ω–æ –Ω–µ—Å–æ–≤–º–µ—Å—Ç–∏–º–∞** —Å WireGuard –±–µ–∑:
- –£—Å—Ç–∞–Ω–æ–≤–∫–∏ `wireguard-go` –Ω–∞ —Ö–æ—Å—Ç-—Å–∏—Å—Ç–µ–º–µ
- –ò–ª–∏ –∞–ø–≥—Ä–µ–π–¥–∞ kernel —Ö–æ—Å—Ç–∞ –¥–æ 5.6+
- –ò–ª–∏ —Å–º–µ–Ω—ã –Ω–∞ KVM –≤–∏—Ä—Ç—É–∞–ª–∏–∑–∞—Ü–∏—é

**–ù–∞–∏–ª—É—á—à–µ–µ –∫—Ä–∞—Ç–∫–æ—Å—Ä–æ—á–Ω–æ–µ —Ä–µ—à–µ–Ω–∏–µ:** Outline VPN (Shadowsocks)  
**–ù–∞–∏–ª—É—á—à–µ–µ –¥–æ–ª–≥–æ—Å—Ä–æ—á–Ω–æ–µ —Ä–µ—à–µ–Ω–∏–µ:** –ú–∏–≥—Ä–∞—Ü–∏—è –Ω–∞ KVM —Å WireGuard

---

**–ê–≤—Ç–æ—Ä –¥–æ–∫—É–º–µ–Ω—Ç–∞:** GitHub Copilot  
**–î–∞—Ç–∞ –ø–æ—Å–ª–µ–¥–Ω–µ–≥–æ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è:** 28 –æ–∫—Ç—è–±—Ä—è 2025, 16:10 UTC
